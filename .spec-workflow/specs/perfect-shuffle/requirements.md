# Requirements Document

## Introduction

Perfect Shuffleは、トレーディングカードゲームのプレイヤーがデッキをランダムにシャッフルする際に使用するWebアプリケーションです。フィッシャー-イェーツアルゴリズムを用いて公平なシャッフル順序を生成し、プレイヤーに「手元のカードの何枚目を次に置くか」を順次指示することで、物理的なカードを正確にシャッフルできるようにします。

このアプリケーションは、カードゲームの大会や練習時に、公平性を保ちながら効率的にデッキをシャッフルしたいプレイヤーのニーズに応えます。

## Alignment with Product Vision

本機能は、カードゲームプレイヤーの公平なゲームプレイを支援するツールとして設計されています。シンプルで直感的なUIにより、大会会場などでも素早く利用でき、シャッフルの透明性を確保します。

## Requirements

### Requirement 1: カード枚数設定画面

**User Story:** カードゲームプレイヤーとして、シャッフルしたいデッキの枚数を簡単に設定できるようにしたい。これにより、様々な枚数のデッキに対応できる。

#### Acceptance Criteria

1. WHEN アプリケーションを初回起動する THEN システム SHALL タイトル「Perfect Shuffle」とサブタイトル「枚数を指定してスタート！」を画面上部に表示する
2. WHEN カード枚数設定画面を表示する THEN システム SHALL デフォルト値として60枚を表示する
3. IF LocalStorageに以前保存された枚数が存在する THEN システム SHALL その枚数をデフォルト値として表示する
4. WHEN ユーザーが「+」ボタンをクリックする THEN システム SHALL 現在の枚数を1枚増やす（最大99枚まで）
5. WHEN ユーザーが「-」ボタンをクリックする THEN システム SHALL 現在の枚数を1枚減らす（最小1枚まで）
6. WHEN 枚数設定画面を表示する THEN システム SHALL 「40」「60」「99」の3つのクイック選択ボタンを表示する
7. WHEN ユーザーがクイック選択ボタンをクリックする THEN システム SHALL 即座にその枚数を設定する
8. WHEN カード枚数設定が完了する THEN システム SHALL 「スタート」ボタンを枚数設定UIの下に表示する

### Requirement 2: シャッフル実行とデータ保存

**User Story:** カードゲームプレイヤーとして、設定した枚数でシャッフルを開始し、次回訪問時も同じ枚数をデフォルトとして使いたい。

#### Acceptance Criteria

1. WHEN ユーザーが「スタート」ボタンをクリックする THEN システム SHALL 現在設定されている枚数をLocalStorageに保存する
2. WHEN 枚数がLocalStorageに保存される THEN システム SHALL フィッシャー-イェーツアルゴリズムを用いてシャッフル順序を生成する
3. WHEN シャッフル順序が生成される THEN システム SHALL シャッフル画面に遷移する
4. IF ユーザーが過去にアプリケーションを使用している THEN システム SHALL 次回訪問時に前回の枚数をデフォルト値として表示する

### Requirement 3: シャッフル順序の表示

**User Story:** カードゲームプレイヤーとして、手元のカードの何枚目を次に置けば良いかを明確に知りたい。これにより、正確にシャッフルされたデッキを作成できる。

#### Acceptance Criteria

1. WHEN シャッフル画面を表示する THEN システム SHALL シャッフル後の最後の位置（N枚目）に来るカードの元の位置（手元のカード束の上からi枚目）を表示する
2. WHEN カード位置を表示する THEN システム SHALL 「○枚目を置いて」という形式で大きく表示する
3. WHEN カード位置を表示する THEN システム SHALL 進捗情報を「X/N」の形式で表示する（X: 現在処理中の番号、N: 総枚数）
4. WHEN カード位置を表示する THEN システム SHALL 「タップで次へ」というメッセージを表示する
5. WHEN ユーザーが画面をタップまたはクリックする THEN システム SHALL 次のカード位置を表示する
6. WHEN 次のカード位置を表示する THEN システム SHALL シャッフル後の順序で逆順に表示する（N枚目 → N-1枚目 → ... → 1枚目）
7. WHEN シャッフル画面を表示する THEN システム SHALL 「中断」ボタンを表示する
8. WHEN ユーザーが「中断」ボタンをクリックする THEN システム SHALL カード枚数設定画面に戻る

### Requirement 4: シャッフル完了処理

**User Story:** カードゲームプレイヤーとして、すべてのカードの配置が完了したことを明確に知り、次のアクションを選択したい。

#### Acceptance Criteria

1. WHEN すべてのカード位置を表示し終える THEN システム SHALL 完了メッセージを表示する
2. WHEN 完了メッセージを表示する THEN システム SHALL 「ホームに戻る」ボタンを表示する
3. WHEN ユーザーが「ホームに戻る」ボタンをクリックする THEN システム SHALL カード枚数設定画面に遷移する

### Requirement 5: フッター表示

**User Story:** アプリケーション利用者として、すべての画面でプライバシーポリシーへのアクセスと著作権情報を確認できるようにしたい。

#### Acceptance Criteria

1. WHEN 任意の画面を表示する THEN システム SHALL ページ下部にフッターを表示する
2. WHEN フッターを表示する THEN システム SHALL 「Privacy Policy」というテキストをリンクとして表示する（href="#"）
3. WHEN フッターを表示する THEN システム SHALL 「© jonnity 2025」というテキストを表示する
4. WHEN フッターを表示する THEN システム SHALL フッターを常に画面下部に固定する

## Non-Functional Requirements

### Code Architecture and Modularity
- **Single Responsibility Principle**: 各コンポーネントは単一の責務を持つこと（例: 枚数設定、シャッフルロジック、表示制御を分離）
- **Modular Design**: シャッフルアルゴリズム、LocalStorage操作、画面遷移ロジックを独立したモジュールとして実装すること
- **Dependency Management**: React Contextまたは状態管理ライブラリを使用して、コンポーネント間の依存を最小化すること
- **Clear Interfaces**: TypeScriptの型定義を活用し、コンポーネント間のインターフェースを明確にすること

### Performance
- シャッフルアルゴリズムの実行時間は、99枚のカードに対して100ms以内であること
- 画面遷移は即座に行われ、ユーザーに待機時間を感じさせないこと
- LocalStorageへのアクセスは非同期処理で行い、UIをブロックしないこと

### Security
- LocalStorageに保存するデータは枚数のみとし、個人情報は保存しないこと
- XSS攻撃を防ぐため、ユーザー入力（枚数）は数値として検証すること

### Reliability
- 無効な枚数（0以下、100以上、非数値）が入力された場合、エラーメッセージを表示し、有効な範囲に修正すること
- LocalStorageが利用できない環境でも、デフォルト値（60枚）で動作すること
- ブラウザの戻るボタンで意図しない画面遷移が発生しないよう、履歴管理を適切に行うこと

### Usability
- UIは375px幅のモバイル画面（iPhone SE サイズ）を基準に設計すること
- タップ可能な要素は最小44x44pxのタッチターゲットサイズを確保すること
- カード位置の数字は、屋外や大会会場など様々な環境で視認しやすい大きさとすること（推奨: 48px以上のフォントサイズ）
- 色のコントラスト比はWCAG AA基準（4.5:1以上）を満たすこと
- ローディング状態が発生する場合は、適切なフィードバックを表示すること
